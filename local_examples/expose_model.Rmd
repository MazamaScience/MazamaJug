---
title: "machine_learning_beakr"
author: "Hans Martin"
date: "10/14/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# Import libraries 
library(beakr)
library(caret)
# Load the Iris data set 
data('iris')
# Train using KNN
knn_model <- train( Species ~ ., 
                  data = iris, 
                  method = 'knn', 
                  trControl = trainControl(method='cv', number=10), 
                  metric = 'Accuracy' )
```

```{r}
predict_species <- function(sl, sw, pl, pw) {
  test <- data.frame( Sepal.Length = sl, 
                      Sepal.Width = sw, 
                      Petal.Length = pl, 
                      Petal.Width = pw, 
                      Species = NA )
  
  species <- predict(knn_model, test)
  
  return(paste0('Predicted species: ', species, ' '))
}

```


```{r, eval=FALSE}
beakr <- newBeakr() %>%  
  POST(path = '/predict-species', decorate(predict_species)) %>% 
  logger() %>% 
  errorHandler() %>% 
  startBeakr(port = 1234, daemon = T)

```


Curl the inputs

$ curl -X POST \
  http://127.0.0.1:1234/predict-species \
  -H 'content-type: application/json' \
  -d '{ "sl": 5.3, "sw": 4, "pl": 1.6, "pw": 0.2 }'

