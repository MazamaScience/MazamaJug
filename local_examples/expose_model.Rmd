---
title: "machine_learning_beakr"
author: "Hans Martin"
date: "10/14/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Import 
library(beakr)
library(caret)

# Load the Iris data set 
data('iris')
# Train using KNN
knn_model <- train( Species ~ ., 
                    data = iris, 
                    method = 'knn', 
                    trControl = trainControl(method='cv', number=10), 
                    metric = 'Accuracy' )

# Function to predict the species using the trained model. 
predict_species <- function(sl, sw, pl, pw) {
  test <- data.frame( Sepal.Length = sl, 
                      Sepal.Width = sw, 
                      Petal.Length = pl, 
                      Petal.Width = pw, 
                      Species = NA )
                      
  return(predict(knn_model, test))
}

# Create the beakr instance 
beakr <- createBeakr()

# Use beakr to expose the model in the '/predict-species' url path. 
#   See help('decorate') for more info about decorating functions. 
beakr %>% 
  beakr::getr('/', function(req, res, err) "Hi") %>% 
  beakr::putr(path = '/predict-species', decorate(predict_species)) %>% 
  handleErrors() %>% 
  listen(host = '127.0.0.1', port = 1234, daemon = TRUE) %>%  
  kill() # Comment line to test example.
```

