---
title: "machine_learning_beakr"
author: "Hans Martin"
date: "10/14/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(beakr)
library(caret)

  # Train using KNN
knn_fit <- train( Species ~ ., 
                  data = iris, 
                  method = 'knn', 
                  trControl = trainControl(method='cv', number=10), 
                  metric = 'Accuracy' )

predict_species <- function(sl, sw, pl, pw) {
  # Capture input 
  iris_test <- data.frame( Sepal.Length = sl, 
                           Sepal.Width = sw, 
                           Petal.Length = pl, 
                           Petal.Width = pw, 
                           Species = NA )
  
  predicted <- predict(knn_fit, iris_test)
  output <- paste0("Predicted species: ", predicted)
  
  return(output)
}
```


```{r, eval=FALSE}
beakr <- newBeakr() %>%  
  POST(path = "/predict-species", decorate(predict_species)) %>% 
  errorHandler() %>% 
  startBeakr(host = "127.0.0.1", port = 1234, daemon = TRUE)

```


Curl the inputs

$ curl -X POST \
  http://127.0.0.1:1234/predict-species \
  -H 'content-type: application/json' \
  -d '{ "sl": 5.3, "sw": 4, "pl": 1.6, "pw": 0.2 }'

